<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM ASTRO - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header com Logo -->
    <header class="main-header">
        <div class="header-left">
            <div class="logo-container">
                <svg class="header-logo-icon" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#00AEEF;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#0088cc;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M50 10 L90 100 L70 100 L50 60 L30 100 L10 100 Z" fill="url(#logoGradient)"/>
                    <path d="M50 40 L65 70 L35 70 Z" fill="#1A1A42"/>
                </svg>
                <div class="logo-text-container">
                    <h1 class="header-logo-text">ASTRO</h1>
                    <span class="header-subtitle">CRM</span>
                </div>
            </div>
        </div>
        
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" id="userNameDisplay">Carregando...</span>
                    <span class="user-email" id="userEmailDisplay"></span>
                </div>
            </div>
            <button onclick="logout()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Sair
            </button>
        </div>
    </header>

    <!-- Toast de Boas-vindas -->
    <div id="welcomeToast" class="welcome-toast">
        <i class="fas fa-rocket"></i>
        <div>
            <strong>Bem-vindo de volta!</strong>
            <p id="toastUserName"></p>
        </div>
        <button onclick="closeToast()" class="toast-close">×</button>
    </div>

    <!-- Navegação -->
    <nav class="main-nav">
        <button class="nav-btn active" onclick="showTab('dashboard')">
            <i class="fas fa-chart-line"></i>
            Dashboard
        </button>
        <button class="nav-btn" id="negociosBtn" onclick="showTab('negocios')">
            <i class="fas fa-dollar-sign"></i>
            Novos Negócios
        </button>
        <button class="nav-btn" onclick="showTab('leads')">
            <i class="fas fa-users"></i>
            Leads
        </button>
        <button class="nav-btn" onclick="showTab('ranking')">
            <i class="fas fa-trophy"></i>
            Ranking
        </button>
    </nav>

    <!-- Dashboard Tab -->
    <div id="dashboardTab" class="tab-content active">
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-users stat-icon"></i>
                <div class="stat-info">
                    <h3 id="totalLeads">0</h3>
                    <p>Total de Leads</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-user-plus stat-icon"></i>
                <div class="stat-info">
                    <h3 id="leadsNovos">0</h3>
                    <p>Novos Leads</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-comments stat-icon"></i>
                <div class="stat-info">
                    <h3 id="leadsContato">0</h3>
                    <p>Em Contato</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-check-circle stat-icon"></i>
                <div class="stat-info">
                    <h3 id="leadsFechados">0</h3>
                    <p>Fechados</p>
                </div>
            </div>
        </div>

        <div class="actions-bar">
            <button onclick="openNewLeadModal()" class="btn-primary">
                <i class="fas fa-plus"></i>
                Novo Lead
            </button>
            <div class="filter-group">
                <button onclick="filterLeads('all')" class="filter-btn active">Todos</button>
                <button onclick="filterLeads('mine')" class="filter-btn">Meus Leads</button>
            </div>
        </div>

        <div class="kanban-board">
            <div class="kanban-column" data-stage="novo">
                <div class="column-header" style="border-color: #6c5ce7;">
                    <i class="fas fa-star"></i>
                    <h3>Novo</h3>
                </div>
                <div id="novoColumn" class="column-content"></div>
            </div>

            <div class="kanban-column" data-stage="contato">
                <div class="column-header" style="border-color: #00b894;">
                    <i class="fas fa-phone"></i>
                    <h3>Em Contato</h3>
                </div>
                <div id="contatoColumn" class="column-content"></div>
            </div>

            <div class="kanban-column" data-stage="interessado">
                <div class="column-header" style="border-color: #fdcb6e;">
                    <i class="fas fa-heart"></i>
                    <h3>Interessado</h3>
                </div>
                <div id="interessadoColumn" class="column-content"></div>
            </div>

            <div class="kanban-column" data-stage="negociacao">
                <div class="column-header" style="border-color: #e17055;">
                    <i class="fas fa-handshake"></i>
                    <h3>Negociação</h3>
                </div>
                <div id="negociacaoColumn" class="column-content"></div>
            </div>

            <div class="kanban-column" data-stage="fechado">
                <div class="column-header" style="border-color: #00b894;">
                    <i class="fas fa-check-circle"></i>
                    <h3>Fechado</h3>
                </div>
                <div id="fechadoColumn" class="column-content"></div>
            </div>

            <div class="kanban-column" data-stage="perdido">
                <div class="column-header" style="border-color: #d63031;">
                    <i class="fas fa-times-circle"></i>
                    <h3>Perdido</h3>
                </div>
                <div id="perdidoColumn" class="column-content"></div>
            </div>
        </div>
    </div>

    <!-- Novos Negócios Tab -->
    <div id="negociosTab" class="tab-content">
        <div class="page-header">
            <h2><i class="fas fa-dollar-sign"></i> Novos Negócios</h2>
            <div class="faturamento-section">
                <div class="filter-periodo">
                    <button onclick="filterFaturamento('dia')" class="periodo-btn active">Dia</button>
                    <button onclick="filterFaturamento('semana')" class="periodo-btn">Semana</button>
                    <button onclick="filterFaturamento('mes')" class="periodo-btn">Mês</button>
                </div>
                <div class="faturamento-total">
                    <span>Faturamento Total:</span>
                    <strong id="faturamentoTotal">R$ 0,00</strong>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="faturamentoChart"></canvas>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>E-mail</th>
                        <th>Telefone</th>
                        <th>Contas</th>
                        <th>Posts/Mês</th>
                        <th>Valor</th>
                        <th>Pagamento</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody id="negociosTableBody">
                    <tr>
                        <td colspan="8" class="empty-state">Nenhum negócio fechado ainda</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Leads Tab -->
    <div id="leadsTab" class="tab-content">
        <div class="page-header">
            <h2><i class="fas fa-users"></i> Todos os Leads</h2>
            <div id="adminLeadFilters" class="admin-filters" style="display: none;">
                <select id="colaboradorFilter" onchange="filterLeadsByColaborador()">
                    <option value="all">Todos os colaboradores</option>
                </select>
            </div>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Instagram</th>
                        <th>WhatsApp</th>
                        <th>Status</th>
                        <th>Responsável</th>
                        <th>Data</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="leadsTableBody">
                    <tr>
                        <td colspan="7" class="empty-state">Nenhum lead cadastrado</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Ranking Tab -->
    <div id="rankingTab" class="tab-content">
        <div class="page-header">
            <h2><i class="fas fa-trophy"></i> Ranking de Performance</h2>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Posição</th>
                        <th>Nome</th>
                        <th>Retornos Positivos</th>
                        <th>Função</th>
                    </tr>
                </thead>
                <tbody id="rankingTableBody">
                    <tr>
                        <td colspan="4" class="empty-state">Carregando ranking...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Novo Lead -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="leadModalTitle">Novo Lead</h2>
                <button onclick="closeLeadModal()" class="modal-close">×</button>
            </div>
            <form id="leadForm" onsubmit="event.preventDefault(); saveLead();">
                <input type="hidden" id="leadId">
                
                <div class="form-group">
                    <label>Nome *</label>
                    <input type="text" id="leadNome" required placeholder="Ex: Flávio Augusto">
                </div>
                
                <div class="form-group">
                    <label>@ do Instagram *</label>
                    <input type="text" id="leadInstagram" required placeholder="Ex: flavioaugustogv">
                </div>
                
                <div class="form-group">
                    <label>WhatsApp *</label>
                    <input type="tel" id="leadTelefone" required placeholder="Ex: (11) 98765-4321">
                </div>
                
                <div class="form-group">
                    <label>Observações</label>
                    <textarea id="leadObservacoes" rows="3" placeholder="Anotações sobre o lead..."></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" onclick="closeLeadModal()" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Fechamento -->
    <div id="closeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirmar Fechamento</h2>
                <button onclick="closeCloseModal()" class="modal-close">×</button>
            </div>
            <form id="closeForm" onsubmit="event.preventDefault(); confirmClose();">
                <input type="hidden" id="closeLeadId">
                
                <div class="form-group">
                    <label>Quantidade de Contas *</label>
                    <input type="number" id="planoContas" required>
                </div>
                
                <div class="form-group">
                    <label>Posts por Mês *</label>
                    <input type="number" id="planoPosts" required>
                </div>
                
                <div class="form-group">
                    <label>Valor do Contrato (R$) *</label>
                    <input type="number" step="0.01" id="planoValor" required>
                </div>
                
                <div class="form-group">
                    <label>Forma de Pagamento *</label>
                    <select id="planoFormaPagamento" required>
                        <option value="">Selecione...</option>
                        <option value="PIX">PIX</option>
                        <option value="Cartão de Crédito">Cartão de Crédito</option>
                        <option value="Boleto">Boleto</option>
                        <option value="Transferência">Transferência</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Observações</label>
                    <textarea id="planoObservacoes" rows="3"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" onclick="closeCloseModal()" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">Confirmar Fechamento</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
